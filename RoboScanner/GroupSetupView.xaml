<UserControl x:Class="RoboScanner.Views.GroupSetupView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:conv="clr-namespace:RoboScanner.Converters">
    <UserControl.Resources>
        <conv:NullableDoubleConverter x:Key="NullDoubleConverter"/>
        <Style TargetType="DataGrid">
            <Setter Property="AutoGenerateColumns" Value="False"/>
            <Setter Property="CanUserAddRows" Value="False"/>
            <Setter Property="CanUserDeleteRows" Value="False"/>
            <Setter Property="GridLinesVisibility" Value="Horizontal"/>
            <Setter Property="HeadersVisibility" Value="Column"/>
        </Style>
    </UserControl.Resources>

    <Grid Margin="16">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Заголовок и действия -->
        <DockPanel Margin="0,0,0,10">
            <TextBlock Text="{DynamicResource GroupSetup.Title}" Style="{StaticResource SectionHeader}" DockPanel.Dock="Left" Margin="0,0,16,0"/>
            <StackPanel Orientation="Horizontal" DockPanel.Dock="Right">
                <Button x:Name="BtnSave" Content="{DynamicResource GroupSetup.Save}" Width="120" Margin="0,0,8,0" Click="BtnSave_Click"/>
                <Button x:Name="BtnLoad" Content="{DynamicResource GroupSetup.Load}" Width="120" Margin="0,0,8,0" Click="BtnLoad_Click"/>
                <Button x:Name="BtnReset" Content="{DynamicResource GroupSetup.Reset}" Width="140" Click="BtnReset_Click"/>
            </StackPanel>
        </DockPanel>

        <!-- Таблица -->
        <DataGrid x:Name="GridRules" Grid.Row="1" ItemsSource="{Binding Rules}">
            <DataGrid.Columns>
                <DataGridTextColumn Header="#" Binding="{Binding Index}" IsReadOnly="True" Width="40"/>

                <DataGridTextColumn Header="{DynamicResource GroupSetup.Col.Name}" Binding="{Binding Name, UpdateSourceTrigger=PropertyChanged}" Width="160"/>
                <DataGridTextColumn Header="{DynamicResource GroupSetup.Col.Description}" Binding="{Binding Description, UpdateSourceTrigger=PropertyChanged}" Width="260"/>

                <!-- MaxX / MaxY / MaxZ с поддержкой пустых значений -->
                <DataGridTemplateColumn Header="{DynamicResource GroupSetup.Col.MaxX}" Width="120">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <TextBlock Text="{Binding MaxX, StringFormat=F2, TargetNullValue=—}"/>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                    <DataGridTemplateColumn.CellEditingTemplate>
                        <DataTemplate>
                            <TextBox Text="{Binding MaxX, Converter={StaticResource NullDoubleConverter}, UpdateSourceTrigger=LostFocus}" />
                        </DataTemplate>
                    </DataGridTemplateColumn.CellEditingTemplate>
                </DataGridTemplateColumn>

                <DataGridTemplateColumn Header="{DynamicResource GroupSetup.Col.MaxY}" Width="120">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <TextBlock Text="{Binding MaxY, StringFormat=F2, TargetNullValue=—}"/>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                    <DataGridTemplateColumn.CellEditingTemplate>
                        <DataTemplate>
                            <TextBox Text="{Binding MaxY, Converter={StaticResource NullDoubleConverter}, UpdateSourceTrigger=LostFocus}" />
                        </DataTemplate>
                    </DataGridTemplateColumn.CellEditingTemplate>
                </DataGridTemplateColumn>

                <DataGridTemplateColumn Header="{DynamicResource GroupSetup.Col.MaxZ}" Width="120">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <TextBlock Text="{Binding MaxZ, StringFormat=F2, TargetNullValue=—}"/>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                    <DataGridTemplateColumn.CellEditingTemplate>
                        <DataTemplate>
                            <TextBox Text="{Binding MaxZ, Converter={StaticResource NullDoubleConverter}, UpdateSourceTrigger=LostFocus}" />
                        </DataTemplate>
                    </DataGridTemplateColumn.CellEditingTemplate>
                </DataGridTemplateColumn>
            </DataGrid.Columns>
        </DataGrid>

        <!-- Подсказка -->
        <TextBlock Grid.Row="2" Margin="0,8,0,0" Foreground="#FF6B7280" FontSize="12"
               Text="{DynamicResource GroupSetup.Hint}"/>
    </Grid>
</UserControl>
